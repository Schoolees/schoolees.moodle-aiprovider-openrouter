# Schoolees OpenRouter AI Provider (aiprovider_openrouter)

## Summary
Schoolees OpenRouter AI Provider for Moodle 5+ (AI subsystem). Adds OpenRouter as an AI provider for text generation/summarisation via the OpenAI-compatible Chat Completions API.

Current stable release: **v1.0.0**

## Requirements
- Moodle **5.0+** (AI subsystem)
- An OpenRouter API key
  - Keys: https://openrouter.ai/keys

## Installation
### Option A: Install from ZIP
1. Site administration → Plugins → Install plugins
2. Upload the plugin ZIP
3. Complete the upgrade

### Option B: Install by copying the folder
Copy this plugin into your Moodle codebase at:

```
<your-moodle-root>/ai/provider/openrouter
```

Then run the Moodle upgrade.

### Release packaging (for Moodle.org)
- The plugin directory name must be `openrouter`.
- The release ZIP root must contain that `openrouter/` directory (not `aiprovider_openrouter/`).
- Expected install path after extraction: `<moodle-root>/ai/provider/openrouter`.

## Configuration
1. Go to **Site administration → AI → Providers**
2. Add/enable **Schoolees OpenRouter AI Provider**
3. Enter your **OpenRouter API key** (and organization ID if required by your OpenRouter setup)

### Action settings
Go to:

**Site administration → AI → Providers → (your OpenRouter instance) → Actions**

You can configure per action:
- Model (e.g. `openrouter/auto`)
- Endpoint (default: `https://openrouter.ai/api/v1/chat/completions`)
- Temperature
- System instruction

## Testing / troubleshooting
### `test_connection.php`
This plugin includes a simple test script:

- `test_connection.php`

It can be used to quickly verify that the provider can reach OpenRouter and receive a valid response.

#### How to run it
1. Ensure the provider is configured:
   - Site administration → AI → Providers → **Schoolees OpenRouter AI Provider**
   - Save a valid **OpenRouter API key**
2. Log in as an admin user.
3. Open the test URL in your browser:

```
https://<your-moodle-site>/ai/provider/openrouter/test_connection.php
```

If the configuration is correct, the page will display a short confirmation response generated by OpenRouter.

#### Notes / safety
- Run it **only as an admin** and preferably in a safe environment.
- Do **not** expose the script publicly (treat it as an admin-only diagnostic page).
- The script uses Moodle’s AI subsystem to run a **Generate text** action.

## Privacy
When enabled, this provider sends data to OpenRouter to generate responses.

Typically sent to OpenRouter includes:
- The **prompt text** for the requested action (e.g. the text you ask to summarise)
- The configured **model** and generation parameters (e.g. temperature)

Notes:
- OpenRouter may store/retain data according to your OpenRouter account settings.
- This plugin does not intentionally send personal data beyond what is included in the prompt.

## Third‑party libraries
This plugin does not bundle any additional third‑party PHP/JS libraries. It uses Moodle core APIs and libraries available in a standard Moodle installation.

If you add third‑party libraries in the future, you should include a `thirdpartylibs.xml` file describing them.

## What changed in the Schoolees fork?
### Branding
- Updated language strings to display **Schoolees** branding while keeping the original Moodle component name `aiprovider_openrouter` (so existing installs remain compatible).

### Moodle 5+ compatibility / robustness fixes
- **Action settings form submission fix (important)**
  - Moodle’s `/ai/configure_actions.php` requires `provider`, `providerid`, and `action` parameters.
  - This fork ensures the action settings forms include the required hidden fields (`provider`, `providerid`, `action`, and `returnurl`) so saving action settings does not fail with `missingparam` (e.g. “A required parameter (provider) was missing”).

### Optional behaviour in this fork
- **Summarise output guardrails**
  - Some deployments prefer hard limits/formatting for summaries.
  - This fork can enforce constraints server-side after the API returns (e.g. word limit and single-paragraph formatting), ensuring consistent output even when models ignore prompt instructions.

## Support / Issues
- Issue tracker: https://github.com/Schoolees/schoolees.moodle-aiprovider-openrouter/issues
- Upstream reference: https://github.com/marcusgreen/moodle-aiprovider_groq

## Versioning
- This project uses Semantic Versioning for releases and tags (for example `v1.0.0`).
- Moodle upgrade versioning still uses the numeric `$plugin->version` field in `version.php`.
- See `CHANGELOG.md` for release history.

## Contributing
See `CONTRIBUTING.md` for contribution and release workflow.

## License
GPL v3 or later (same as Moodle). See `LICENSE`.

## Credits
- Original author: Marcus Green
- Schoolees fork: branding + Moodle 5+ fixes
